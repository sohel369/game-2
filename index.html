<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Lost Whistle ‚Äî Integrity Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #e6f0ff;
      --card: #ffffff;
      --accent: #0288d1;
      --good: #43a047;
      --bad: #d32f2f;
      --muted: #546e7a;
      --orange: #ff9800;
      --yellow: #ffca28;
    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Comic Neue', sans-serif;
      margin: 0;
      background: linear-gradient(180deg, var(--bg), #bbdefb);
      color: #263238;
      font-size: 18px;
      line-height: 1.5;
    }
    .wrap { max-width: 960px; margin: 32px auto; padding: 16px; }
    header { display: flex; align-items: center; gap: 16px; justify-content: space-between; padding: 16px; background: var(--card); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    header h1 { font-size: 24px; margin: 0; color: var(--accent); }
    .card { background: var(--card); border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); padding: 24px; margin-top: 24px; }

    /* Game area */
    .scene { min-height: 300px; position: relative; border-radius: 16px; overflow: hidden; border: 2px solid var(--accent); }
    .field { 
      width: 100%; 
      height: 300px; 
      background: linear-gradient(180deg, #4caf50, #2e7d32); 
      position: relative; 
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect x="0" y="0" width="50" height="100" fill="rgba(255,255,255,0.1)"/></svg>'); 
      background-size: 50px 50px; 
    }
    .player { position: absolute; bottom: 32px; text-align: center; transition: transform 0.3s ease; }
    .player:hover { transform: scale(1.1); }
    .player .body { width: 80px; height: 80px; background: #ffe082; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; border: 3px solid #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    .coach .body { background: #90caf9; }
    .referee .body { background: #fff176; }
    .carla .body { background: #f06292; }
    .ball { position: absolute; right: 15%; bottom: 48px; width: 40px; height: 40px; border-radius: 50%; background: radial-gradient(circle, #fff 10%, #d32f2f 70%); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 24px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); animation: bounce 2s infinite; }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    /* Thought bubble */
    .thought { position: absolute; top: 20px; left: 50px; background: #fff; padding: 12px 16px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.15); transform-origin: top left; animation: pop 0.5s ease; font-weight: 700; }
    .thought::after { content: ''; position: absolute; left: 16px; bottom: -10px; border-width: 12px 12px 0 0; border-style: solid; border-color: #fff transparent transparent transparent; }
    @keyframes pop { 0% { transform: scale(0.2) translateY(-20px); opacity: 0; } 80% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }

    /* Buttons */
    .choices { display: flex; gap: 16px; justify-content: center; margin-top: 16px; flex-wrap: wrap; }
    button.choice { padding: 12px 24px; border-radius: 12px; border: none; background: var(--accent); color: #fff; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2); transition: background 0.3s, transform 0.2s; font-size: 16px; }
    button.choice:hover { background: #0277bd; transform: scale(1.05); }
    button.choice:active { transform: translateY(2px); }

    /* Outcome */
    .outcome-area { display: flex; flex-direction: column; align-items: center; gap: 12px; padding: 16px; }
    .message { font-weight: 700; font-size: 20px; }
    .applause { display: flex; gap: 8px; align-items: center; font-size: 24px; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Star burst */
    .burst { position: absolute; top: 10%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; }
    .star { width: 16px; height: 16px; border-radius: 50%; background: var(--yellow); position: absolute; opacity: 0; animation: burst 1s linear forwards; }
    @keyframes burst { 0% { transform: translate(0,0) scale(0.2); opacity: 1; } 100% { transform: translate(var(--tx),var(--ty)) scale(1.5); opacity: 0; } }

    /* Quiz */
    .quiz { display: grid; gap: 16px; }
    .q { padding: 16px; border-radius: 12px; border: 1px solid #e0f2fe; background: #f5faff; }
    .options { display: flex; flex-direction: column; gap: 12px; }
    .opt { padding: 12px; border-radius: 10px; border: 1px solid #e0f2fe; background: #fff; cursor: pointer; transition: transform 0.2s; }
    .opt:hover { transform: scale(1.02); }
    .opt.correct { border-color: var(--good); background: #e8f5e9; }
    .opt.incorrect { border-color: var(--bad); background: #ffebee; }

    /* Badge */
    .badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 999px; background: linear-gradient(90deg, var(--yellow), #ffb300); box-shadow: 0 6px 20px rgba(255,181,0,0.3); font-weight: 700; font-size: 18px; }
    .badge svg { width: 24px; height: 24px; }

    /* Progress Bar */
    .progress { width: 100%; height: 10px; background: #e0f2fe; border-radius: 5px; margin-bottom: 24px; overflow: hidden; }
    .progress-bar { height: 100%; background: var(--accent); border-radius: 5px; transition: width 0.4s ease; }

    /* Certificate */
    .certificate { margin-top: 24px; padding: 24px; background: linear-gradient(135deg, #fffde7, #fff); border: 3px solid var(--yellow); border-radius: 16px; text-align: center; position: relative; }
    .certificate h2 { margin: 0; font-size: 28px; color: var(--good); }
    .certificate::before { content: 'üèÜ'; position: absolute; top: 10px; right: 10px; font-size: 32px; }

    /* Accessibility */
    button:focus { outline: 3px solid var(--accent); outline-offset: 2px; }
    [aria-live="polite"] { font-weight: 700; }

    /* Responsive */
    @media (max-width: 640px) {
      .wrap { padding: 12px; }
      .player .body { width: 60px; height: 60px; font-size: 14px; }
      .ball { right: 10%; width: 32px; height: 32px; }
      .choices { flex-direction: column; }
      .thought { left: 20px; font-size: 14px; }
    }
    @media (max-width: 320px) {
      .wrap { padding: 8px; }
      .player .body { width: 50px; height: 50px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex;align-items:center;gap:16px">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2l3 7h7l-5.5 4 2 7L12 16l-6.5 4 2-7L2 9h7l3-7z" fill="#0288d1"/></svg>
        <div>
          <h1 id="title">The Lost Whistle ‚Äî Integrity Game</h1>
          <div id="subtitle" style="color:var(--muted);font-size:14px">Fun interactive game teaching kids about honesty in sports!</div>
        </div>
      </div>
    </header>

    <div id="progress" class="progress"><div class="progress-bar"></div></div>

    <div class="card">
      <section id="scene" class="scene">
        <div class="field" id="field">
          <div class="coach" id="leo" style="left:5%;">
            <div class="body">Coach Leo</div>
          </div>
          <div class="player" id="nico" style="left:25%;">
            <div class="body">Nico</div>
          </div>
          <div class="carla" id="carla" style="left:45%;">
            <div class="body">Carla</div>
          </div>
          <div class="referee" id="ref" style="right:5%;">
            <div class="body">Referee</div>
          </div>
          <div class="ball" id="ball">‚öΩ</div>
        </div>
        <div class="burst" id="burst"></div>
      </section>

      <div id="ui" style="padding:24px">
        <!-- decision area -->
        <div id="decision">
          <div class="thought" id="thought" aria-live="polite">Nobody saw it... what do I do?</div>
          <div class="choices">
            <button class="choice" data-choice="truth" aria-label="Raise hand and tell the truth">Raise hand and tell the truth</button>
            <button class="choice" data-choice="silent" aria-label="Stay silent">Stay silent</button>
          </div>
        </div>

        <!-- outcome area -->
        <div id="outcome" style="display:none">
          <div class="outcome-area card" id="outcomeCard">
            <div class="message" id="msg" aria-live="polite"></div>
            <div class="applause" id="applause"></div>
            <div style="font-size:16px;color:var(--muted);text-align:center" id="explain"></div>
            <div style="margin-top:12px"><button id="nextToReflect" class="choice" aria-label="Continue to reflection">Continue</button></div>
          </div>
        </div>

        <!-- reflection -->
        <div id="reflect" style="display:none;margin-top:24px">
          <div class="card">
            <div style="font-weight:700;font-size:20px">Reflection</div>
            <div style="margin-top:12px">How does your team feel when you tell the truth?</div>
            <div style="display:flex;gap:12px;margin-top:12px;justify-content:center">
              <button class="opt-ref" aria-label="Happy">üòä Happy</button>
              <button class="opt-ref" aria-label="Confused">üòï Confused</button>
              <button class="opt-ref" aria-label="Proud">üòé Proud</button>
            </div>
            <div style="margin-top:16px">Mini-challenge: At practice today, try to be honest even if no one is watching!</div>
            <div class="card" style="margin-top:24px">
              <div style="font-weight:700;font-size:18px">Real Story: Lionel Messi & Paolo Di Canio</div>
              <div style="margin-top:12px">In 2000, Paolo Di Canio stopped a game to help an injured opponent, earning the FIFA Fair Play Award. Lionel Messi once admitted to a referee that he scored with his hand, giving up a goal to stay honest. These choices show how honesty builds trust!</div>
            </div>
            <div style="margin-top:12px"><button id="toQuiz" class="choice" aria-label="Take quiz">Take Quiz</button></div>
          </div>
        </div>

        <!-- quiz -->
        <div id="quizWrap" style="display:none;margin-top:24px">
          <div class="card quiz" id="quiz"></div>
          <div style="margin-top:16px;text-align:center"><button id="finish" class="choice" aria-label="Finish and claim badge">Finish & Claim Badge</button></div>
        </div>

        <!-- badge area -->
        <div id="badgeWrap" style="display:none;margin-top:24px;text-align:center">
          <div class="card">
            <div style="font-size:24px;font-weight:700">You Earned a Badge!</div>
            <div style="margin-top:12px">
              <span class="badge">
                <svg viewBox="0 0 24 24" fill="none" stroke="#263238" stroke-width="2"><path d="M12 2l3 7h7l-5.5 4 2 7L12 16l-6.5 4 2-7L2 9h7l3-7z"/></svg>
                Honesty Star
              </span>
            </div>
            <div style="margin-top:12px;color:var(--muted)">Saved to your browser!</div>
            <div class="certificate">
              <h2>Certificate of Honesty</h2>
              <p>Congratulations! You‚Äôve learned about integrity in sports.</p>
              <p>Date: September 6, 2025</p>
              <button id="downloadCert" class="choice" aria-label="Download certificate">Download Certificate</button>
            </div>
            <div style="margin-top:16px"><button id="restart" class="choice" aria-label="Play again">Play Again</button></div>
          </div>
        </div>
      </div>
    </div>

    <footer style="text-align:center;color:var(--muted);margin-top:24px">Built for kids to learn integrity through fun and interactive gameplay!</footer>
  </div>

  <!-- Placeholder for sounds -->
  <audio id="positiveSound" src="https://example.com/positive.mp3" preload="auto"></audio>
  <audio id="negativeSound" src="https://example.com/negative.mp3" preload="auto"></audio>
  <audio id="clickSound" src="https://example.com/click.mp3" preload="auto"></audio>

  <script>
    // Quiz questions
    let questions = [
      {
        q: "If the referee doesn't see the ball go out, what should you do?",
        opts: ["Stay silent", "Raise your hand and tell the truth", "Keep playing like nothing happened"],
        a: 1
      },
      {
        q: "When you win a point that isn't yours, what's the right thing to do?",
        opts: ["Keep it secret", "Admit it, even if you lose the point", "Laugh because you got lucky"],
        a: 1
      },
      {
        q: "If your teammate makes a mistake, what do you do?",
        opts: ["Tease them", "Encourage them to keep going", "Ignore them"],
        a: 1
      }
    ];

    // Elements
    const choices = document.querySelectorAll('button.choice[data-choice]');
    const thought = document.getElementById('thought');
    const decision = document.getElementById('decision');
    const outcome = document.getElementById('outcome');
    const msg = document.getElementById('msg');
    const applause = document.getElementById('applause');
    const explain = document.getElementById('explain');
    const nextToReflect = document.getElementById('nextToReflect');
    const reflect = document.getElementById('reflect');
    const toQuiz = document.getElementById('toQuiz');
    const quizWrap = document.getElementById('quizWrap');
    const quizDiv = document.getElementById('quiz');
    const finish = document.getElementById('finish');
    const badgeWrap = document.getElementById('badgeWrap');
    const restart = document.getElementById('restart');
    const burst = document.getElementById('burst');
    const progressBar = document.querySelector('.progress-bar');

    // Shuffle questions
    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    // Star burst animation
    function starBurst() {
      burst.innerHTML = '';
      for (let i = 0; i < 10; i++) {
        const s = document.createElement('div');
        s.className = 'star';
        const tx = (Math.random() * 200 - 100) + 'px';
        const ty = (Math.random() * 150 - 75) + 'px';
        s.style.setProperty('--tx', tx);
        s.style.setProperty('--ty', ty);
        s.style.left = '0';
        s.style.top = '0';
        burst.appendChild(s);
      }
      setTimeout(() => burst.innerHTML = '', 1000);
    }

    // Update progress
    function updateProgress(percent) {
      progressBar.style.width = `${percent}%`;
    }

    // Handle decision
    choices.forEach(btn => btn.addEventListener('click', e => {
      // document.getElementById('clickSound').play();
      const c = e.currentTarget.dataset.choice;
      decision.style.display = 'none';
      outcome.style.display = 'block';
      updateProgress(33);
      if (c === 'truth') {
        msg.textContent = 'You told the truth ‚Äî your team trusts you!';
        applause.innerHTML = 'üëèüëè Your teammates cheer!';
        explain.textContent = 'Honesty builds trust and shows courage!';
        starBurst();
        // document.getElementById('positiveSound').play();
      } else {
        msg.textContent = 'You stayed silent ‚Äî your teammates seem confused.';
        applause.innerHTML = 'üòï Your teammates look unsure.';
        explain.textContent = 'Staying quiet can hurt your team‚Äôs trust.';
        // document.getElementById('negativeSound').play();
      }
    }));

    nextToReflect.addEventListener('click', () => {
      // document.getElementById('clickSound').play();
      outcome.style.display = 'none';
      reflect.style.display = 'block';
      updateProgress(50);
    });

    // Reflection buttons
    document.querySelectorAll('.opt-ref').forEach(b => b.addEventListener('click', e => {
      // document.getElementById('clickSound').play();
      e.currentTarget.style.transform = 'scale(1.05)';
      setTimeout(() => e.currentTarget.style.transform = '', 300);
    }));

    toQuiz.addEventListener('click', () => {
      // document.getElementById('clickSound').play();
      reflect.style.display = 'none';
      quizWrap.style.display = 'block';
      renderQuiz();
      updateProgress(75);
    });

    function renderQuiz() {
      questions = shuffle(questions);
      quizDiv.innerHTML = '';
      questions.forEach((qq, idx) => {
        const qWrap = document.createElement('div');
        qWrap.className = 'q';
        const qTitle = document.createElement('div');
        qTitle.textContent = `${idx + 1}. ${qq.q}`;
        qWrap.appendChild(qTitle);
        const opts = document.createElement('div');
        opts.className = 'options';
        qq.opts.forEach((op, i) => {
          const b = document.createElement('div');
          b.className = 'opt';
          b.textContent = op;
          b.setAttribute('aria-label', op);
          b.addEventListener('click', () => {
            // document.getElementById('clickSound').play();
            if (b.classList.contains('answered')) return;
            b.classList.add('answered');
            if (i === qq.a) {
              b.classList.add('correct');
              b.textContent = '‚úÖ ' + b.textContent;
            } else {
              b.classList.add('incorrect');
              b.textContent = '‚ùå ' + b.textContent;
            }
          });
          opts.appendChild(b);
        });
        qWrap.appendChild(opts);
        quizDiv.appendChild(qWrap);
      });
    }

    finish.addEventListener('click', () => {
      // document.getElementById('clickSound').play();
      localStorage.setItem('honestyBadge', 'earned');
      quizWrap.style.display = 'none';
      badgeWrap.style.display = 'block';
      updateProgress(100);
    });

    // Download certificate
    document.getElementById('downloadCert').addEventListener('click', () => {
      // document.getElementById('clickSound').play();
      const certText = `Certificate of Honesty\nCongratulations! You've learned about integrity in sports.\nDate: September 6, 2025`;
      const blob = new Blob([certText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'honesty_certificate.txt';
      a.click();
      URL.revokeObjectURL(url);
    });

    restart.addEventListener('click', () => {
      // document.getElementById('clickSound').play();
      badgeWrap.style.display = 'none';
      decision.style.display = 'block';
      outcome.style.display = 'none';
      reflect.style.display = 'none';
      quizWrap.style.display = 'none';
      updateProgress(0);
    });

    // On load: check badge
    window.addEventListener('load', () => {
      const has = localStorage.getItem('honestyBadge');
      if (has) {
        decision.style.display = 'none';
        outcome.style.display = 'none';
        reflect.style.display = 'none';
        quizWrap.style.display = 'none';
        badgeWrap.style.display = 'block';
        updateProgress(100);
      } else {
        updateProgress(0);
      }
    });
  </script>
</body>
</html>